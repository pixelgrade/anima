/**
 * Use this mixin to change the inherited font declaration 
 * of an element or container.
 */
@mixin calculate-fluid-font-size {
    // solving a first degree equation: y = ax + b
    --y1: var(--font-size);
    --y0-new: calc( var(--y1) - ( var(--y1) - var(--y0) ) * var(--theme-font-size-slope-adjust) );

    // calculate the slope and the remainder for the equation
    --a: calc( ( var(--y1) - var(--y0-new) ) / ( var(--x1) - var(--x0) ) );
    --b: calc( var(--y0-new) - var(--a) * var(--x0) );

    // x2 - viewport width at a given time
    // y2 - font size value we need to find out
    --y2: calc( var(--a) * 100vw + var(--b) * 1px );
    --current-font-size: calc( var(--font-size-modifier) * var(--font-size-base) * ( var(--y2) + var(--theme-addon) ) );
}

/**
 * Overwrite elements whose properties are declared by a 3rd
 * party by setting all the font properties again.
 *
 * Examples: sales badges inherit font rules from WooCommerce plugin
 */
@mixin apply-font-properties {
    font-family: var(--current-font-family);
    font-size: var(--current-font-size);
    line-height: var(--current-line-height);
    font-weight: var(--current-font-weight);
    font-style: var(--current-font-style);
    letter-spacing: var(--current-letter-spacing);
    text-transform: var(--current-text-transform);
}

%apply-font-properties {
    @include apply-font-properties;
}

%fluid-font {
    @extend %apply-font-properties;
    @include calculate-fluid-font-size;
}

@mixin apply-font( $name ) {
    @extend %fluid-font;

    $config: map-get( $theme-fonts, $name );

    @if ( map_get( $config, font-size ) ) {
        --font-size: var(--theme-#{$name}-font-size);
    }

    @each $prop, $value in $config {
        @if $prop != font-size {
            --current-#{ $prop }: var(--theme-#{ $name }-#{ $prop });
        }
    }
}

/**
 * Use this mixin on containers or elements, when you need 
 * to overwrite the universal selector (*) specificity
 *
 * Examples: input fields, image captions
 */
@mixin apply-font-size( $size ) {
    --font-size: $size;
    font-size: var(--current-font-size);
}
